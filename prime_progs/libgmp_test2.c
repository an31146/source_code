/*
 *  gcc -Wall -O2 -std=c99 -o libgmp_test libgmp_test.c -lm -lgmp
 */
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <time.h>
#include <gmp.h>

int base_primes[25] = {2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97};

bool fermat_test(const mpz_t n, int rounds)
{
    mpz_t a, n1, n_sub_one;
    //char __UNUSED_PARAM(str1[1024]);
    int i;
    
    if ( mpz_tdiv_ui(n, 3L) == 0 ||
         mpz_tdiv_ui(n, 5L) == 0 ||
         mpz_tdiv_ui(n, 7L) == 0 )
        return false;
        
    mpz_init(n1);
    mpz_init_set(n_sub_one, n);
    mpz_sub_ui(n_sub_one, n_sub_one, 1);
    for (i=0; i<rounds; i++)
    {
        mpz_init_set_ui(a, base_primes[i]);
        mpz_mod(a, a, n);

        mpz_powm(n1, a, n_sub_one, n);
        //mpz_get_str(str1, 10, a);
        //printf("%s - ", str1);
        
        if (mpz_cmp_ui(n1, 1)!= 0)
            return false;
    }
    return true;
}

bool miller_rabin(const mpz_t n, int rounds)
{
    int r;
    bool is_prime = true;
    mpz_t nm1, x, y, q;
    unsigned long k, i;

    int base_primes[54] =  {  2,   3,   5,   7,  11,  13,  17,  19,
                             23,  29,  31,  37,  41,  43,  47,  53,
                             59,  61,  67,  71,  73,  79,  83,  89,
       	                     97, 101, 103, 107, 109, 113, 127, 131,
                            137, 139, 149, 151, 157, 163, 167, 173,
                            179, 181, 191, 193, 197, 199, 211, 223,
                            227, 229, 233, 239, 241, 251
                           };

    for (int i = 0; i < sizeof(base_primes)/sizeof(int); i++ )
        if (mpz_divisible_ui_p(n, base_primes[i]))
            return false;

    /*
    if ( mpz_divisible_ui_p(n, 3L) ||
         mpz_divisible_ui_p(n, 5L) ||
         mpz_divisible_ui_p(n, 7L) ||
         mpz_divisible_ui_p(n, 11L) ||
         mpz_divisible_ui_p(n, 13L) ||
         mpz_divisible_ui_p(n, 19L) ||
         mpz_divisible_ui_p(n, 23L) ||
         mpz_divisible_ui_p(n, 29L)  )
        return false;
    */
        
    mpz_init(nm1);
    mpz_init(x);
    mpz_init(y);
    mpz_init(q);
    
    mpz_sub_ui(nm1, n, 1L);
    
    /* Find q and k, where q is odd and n = 1 + 2**k * q.  */
    k = mpz_scan1(nm1, 0L);
    mpz_tdiv_q_2exp(q, nm1, k);
    
    for (r=0; r<rounds && is_prime; r++)
    {
        /* 2 to n-2 inclusive, don't want 1, 0 or -1 */
        mpz_set_ui(x, rand());
        mpz_powm(y, x, q, n);
        
        if (mpz_cmp_ui (y, 1L) == 0 || mpz_cmp (y, nm1) == 0)
        {
            is_prime = true;
            continue;                       // next round
        }
        
        for (i=1; i<k; i++)
        {
            mpz_powm_ui (y, y, 2L, n);
            if (mpz_cmp (y, nm1) == 0)
            {
                is_prime = true;            // next round
                break;
            }
            if (mpz_cmp_ui (y, 1L) == 0)
            {
                is_prime = false;           // should exit
                break;
            }
        }
        if (i == k)
	{
            is_prime = false;
            break;
	}
    }   
    return is_prime;
}

void powers_of_two()
{
	mpz_t a, b, c;
	unsigned long start, stop, i;
	unsigned int expos[6] = {0x1000, 9689L, 110503L, 216091L, 756839L, 1257787L};

	mpz_init(a);
	mpz_init(b);
	mpz_init(c);

    for (i=0; i<6; i++)
    {
        mpz_set_ui(a, 1);
    	mpz_mul_2exp(a, a, expos[i]);           // a = 2^4096
    	mpz_sub_ui(a, a, 1L);                   //   = 2^4096-1
        mpz_sub_ui(b, b, 1L);                   // b = 2^4096-2
    	
    	start = clock();
    	printf("\nmpz_sizeinbase(2^%d-1, 10) = %d\t\t", expos[i], mpz_sizeinbase(a, 10));
    	stop = clock();
    	printf("time: %ld ms\n", (stop-start)/1000);
    	//printf("mpz_sizeinbase(2^1048576, 10) = %lu\n", mpz_sizeinbase(a, 10));
    			
        mpz_set_ui(c, 13L);
        start = clock();
        //mpz_powm(c, c, b, a);                 // c = c^b mod a
        stop = clock();
        
        if (mpz_cmp_ui(c, 1L) == 0)
            printf("\npowm time: %ld ms\n\n", (stop-start)/1000);
    }
}

void print_time(FILE *F)
{
	time_t t = time(NULL);
        char str_t[30];
        strcpy(str_t, asctime(localtime(&t)));
	str_t[24] = 0;
        //strncpy(str_t, str_t, strlen(str_t)-2);
        printf("[%s]\n", str_t);
        fprintf(F, "[%s]\n", str_t);
}

int main()
{
	mpz_t a, b, c, d;
	char str_out[262144];
	char str_out2[262144];
	long f = 0, n, start, stop;
	
	mpz_init(a);
	mpz_init(b);
	mpz_init(c);
 	mpz_init(d);
	//mpz_set_ui(a, 1);
	//mpz_set_ui(b, 2);
	//mpz_set_ui(c, 1000000011L);
	//mpz_set_str(c, "1237940075278319013244460992103628753054475013", 10);
	//mpz_set_str(c, "67399868083273799563567977110671938751166936794494779375573996285276182286171", 10);
	
	mpz_set_str(c, "9502f934800000083400000001e0000005cd0000000d4800000080c000000f63", 16);
	
	for (long i=0; i<1; i++)
	{
	    start = clock();
	    while (!miller_rabin(c, 3))
	        mpz_add_ui(c, c, 2);
	    stop = clock();
	        
	    mpz_get_str(str_out, 16, c);
	    printf("%s\n%d digits - %d bits - ", str_out, mpz_sizeinbase(c, 10), mpz_sizeinbase(c, 2));
	    printf("time: %ld ms\n\n", (stop-start)/1000);
	    //mpz_mul_ui(c, c, 262144);
	    mpz_mul_2exp(c, c, 256);
	    mpz_add_ui(c, c, 1);
	}
	
	mpz_set_ui(a, 2L);
	mpz_pow_ui(a, a, 63);                   // 2^63
	mpz_sub_ui(a, a, 1);                    // 2^63-1
	mpz_get_str(str_out, 16, a);
	
	printf("2^63-1 = 0x%s\n\n", str_out);

	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817292456341", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817291778041", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817292576601", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817333213959", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817374066991", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817412326209", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817426922943", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817467221931", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817473988923", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817514623071", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817514834499", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817555470261", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817596038823", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817624933971", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817665562113", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817669625739", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817686143601", 10);

	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817721755089", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817762388883", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817771085031", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817796740011", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817837198071", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817877728491", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817918312863", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817954009683", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607817994470479", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818023357611", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818064021489", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818104476831", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818144909901", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818185362891", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818225984133", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818266572969", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818307048579", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818347656201", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818388201219", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818428816143", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818463536721", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818463736833", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818504306661", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818544811893", 10);
	//mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148117531819", 10);
	//mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148148324671", 10);
	//mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148178659219", 10);
	//mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148181650753", 10);
	// accidentally copied from parallella session
	//
	//mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148212433981", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818549242953", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818589420933", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818629693923", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818630472309", 10);

	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818645034849", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818685045741", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818725147719", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818750002293", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818785627971", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818825656773", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818865684339", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818905725219", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818945790111", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607818985964833", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819026018751", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819066040161", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819106114203", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819145917831", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819185714799", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819192691833", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819232452249", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819261170391", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819301005933", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819321999669", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819361803009", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819401327403", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819441094671", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819480837153", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819519990663", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819559840839", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819599727489", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819639519831", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819679028253", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819718715883", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819758288439", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819797925189", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819837591429", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819848747553", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819878423733", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819918976971", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607819959588421", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820000191573", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820040733489", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820081313721", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820121903871", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820162518591", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820203157941", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820243699419", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820284210873", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820284334749", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820324967193", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820365517401", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820406141091", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820446773469", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820487227911", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820527903501", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820568512959", 10);
	//mpz_set_str(c, "158931334268315880905650934137357364743068772075658810649075047312082034642592490448418403770075197985927611076971005579058636974570607820609079343", 10);
	mpz_set_str(c, "643808006803554439230129854961492699151386107534013432918073439524138264842370630061369715394739134090922937332590384720397133335969549256322620979036686633213903952966175107096769180017646161851573148620880729", 10);

	start = clock() / 1000;
	printf("clock() = %ld\n\n", clock() / 1000);

	FILE *F_TP = fopen("./twin_primes.txt", "a+");
	if(!F_TP) {
		printf("File opening failed.\n");
		return EXIT_FAILURE;
	}

	while (start+3600000L > clock() / 1000)
	{
		while (!miller_rabin(c, 3))
		{
			mpz_add_ui(c, c, 2);

			switch(f)
			{	
				case 0: printf("[|]\r");
					break;
				case 1: printf("[/]\r");
					break;
				case 2: printf("[-]\r");
					break;
				case 3: printf("[\\]\r");
					break;
			}
			fflush(stdout);
			f++; f %= 4;

			/*
			putchar('.');
			f++;
			if (f == 120)
			{
				f = 0;
				printf("\r                                                                                                                        \r");
			}
			*/
			//f = !f;
		} // while

		mpz_add_ui(d, c, 2);
		if (miller_rabin(d, 3))
		{
			print_time(F_TP);
			mpz_get_str(str_out, 10, c);
			mpz_get_str(str_out2, 10, d);
			printf("\n%s\n%s\n\n", str_out, str_out2);
			fprintf(F_TP, "\n%s\n%s\n\n", str_out, str_out2);
			fflush(F_TP);
		}
		mpz_add_ui(c, d, 2);
	}  // while 
	fclose(F_TP);

	//powers_of_two();
    
	printf("\nEnter n: ");
	scanf("%ld", &n);

	mpz_fac_ui(b, n);
	//mpz_sub_ui(b, b, 1);
	mpz_get_str(str_out, 10, b);
	
	printf("\nfact(%ld) = %s\nfact(%ld).length = %d\n", n, str_out, n, mpz_sizeinbase(b, 10));
	
	mpz_set_ui(a, 2);

	for (long i=0; i<n; i++)
	    mpz_mul_ui(a, a, 100);

	mpz_sqrt(b, a);
	
	mpz_get_str(str_out, 10, a);
	printf("\nsqrt(%s) =\n", str_out);
	mpz_get_str(str_out, 10, b);
	printf("%s\n", str_out);
	
	return 0;	
}

